<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>lovealina</title>
  
  <!-- –î–æ–±–∞–≤–ª—è–µ–º Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  
  <style>
    :root{--bg1:#ffedf0;--bg2:#ffe6f2;--card:#fff;--accent:#ff5c8a;--text:#3b2a33}
    .night-mode{--bg1:#0a0a2a;--bg2:#0a0a2a;--card:#1e1e3a;--accent:#ffd700;--text:#e6e6ff}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg1);
      display:flex;align-items:flex-start;justify-content:center;padding:32px;color:var(--text);
      overflow-y:auto;
      min-height:100vh;
      transition: all 0.5s ease;
    }

   /* floating hearts - —Ç–æ–ª—å–∫–æ –≤ –¥–Ω–µ–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ */
    .hearts{position:fixed;inset:0;z-index:1}
    .hearts i{
      position:absolute;
      display:block;
      width:28px;
      height:28px;
      background:var(--accent);
      transform:rotate(45deg);
      border-radius:4px;
      opacity:0.9;
      cursor:pointer;
    }    
    .hearts i:before,.hearts i:after{
      content:'';
      position:absolute;
      width:28px;
      height:28px;
      background:var(--accent);
      border-radius:50%;
    }
    .hearts i:before{top:-14px;left:0}
    .hearts i:after{left:-14px;top:0}
    
    @keyframes heartExplosion {
      0% { transform: scale(1) rotate(45deg); opacity: 1; }
      50% { transform: scale(1.5) rotate(45deg); opacity: 0.7; }
      100% { transform: scale(2) rotate(45deg); opacity: 0; }
    }
    .heart-explode {
      animation: heartExplosion 0.6s ease-out forwards;
      pointer-events: none;
    }

    /* floating stars - —Ç–æ–ª—å–∫–æ –≤ –Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ */
    .stars{position:fixed;inset:0;z-index:1;display:none}
    .night-mode .stars{display:block}
    .stars i{
      position:absolute;
      display:block;
      width:36px;
      height:36px;
      background:#ffd700;
      clip-path: polygon(
        50% 0%,
        61% 35%,
        98% 35%,
        68% 57%,
        79% 91%,
        50% 70%,
        21% 91%,
        32% 57%,
        2% 35%,
        39% 35%
      );
      opacity:0.9;
      cursor:pointer;
      filter: drop-shadow(0 0 8px #ffd700) drop-shadow(0 0 12px #ffd700);
      transition:all 0.3s ease;
    }
    
    @keyframes starExplosion {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.7; }
      100% { transform: scale(2); opacity: 0; }
    }
    .star-explode {
      animation: starExplosion 0.6s ease-out forwards;
      pointer-events: none;
    }

    .card{
      width:min(760px,96vw);
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,250,252,0.9));
      border-radius:20px;padding:28px;box-shadow:0 10px 30px rgba(78,30,60,0.12);
      position:relative;z-index:2;backdrop-filter: blur(6px);
      margin:20px 0;
      transition: all 0.5s ease;
    }
    .night-mode .card{
      background:linear-gradient(180deg, rgba(30,30,58,0.9), rgba(26,26,52,0.9));
      box-shadow:0 10px 30px rgba(255,215,0,0.2);
    }
    .header{display:flex;gap:16px;align-items:center}
    .logo{
      width:76px;height:76px;border-radius:18px;background:conic-gradient(from 200deg at 50% 50%, #ffd3e6, #ff9cc0 30%, #ff6b95 60%);
      display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(255,110,150,0.15);
      transition: all 0.5s ease;
    }
    .night-mode .logo{
      background:conic-gradient(from 200deg at 50% 50%, #ffd700, #ffed4e 30%, #ffdb58 60%);
      box-shadow:0 6px 18px rgba(255,215,0,0.3);
    }
    .logo svg{width:48px;height:48px;filter:drop-shadow(0 6px 10px rgba(255,110,150,0.12))}
    .night-mode .logo svg{filter:drop-shadow(0 6px 10px rgba(255,215,0,0.3))}
    h1{font-size:1.6rem;margin:0}
    p.lead{margin:8px 0 0;color:var(--text)}

    /* –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ */
    .section {
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 5px 20px rgba(255,92,138,0.1);
      border: 2px dashed rgba(255,92,138,0.3);
      transition: all 0.5s ease;
    }
    .night-mode .section {
      background: rgba(30,30,58,0.95);
      box-shadow: 0 5px 20px rgba(255,215,0,0.2);
      border: 2px dashed rgba(255,215,0,0.4);
    }

    footer{margin-top:18px;color:#774;opacity:0.9;font-size:0.9rem}
    .night-mode footer{color:#a8a8ff}

    /* –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã */
    .compliment-generator {
      text-align: center;
    }

    .compliment-box {
      background: linear-gradient(135deg, #fff0f5, #ffe6f2);
      border-radius: 15px;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid var(--accent);
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 600;
      color: #5b3f47;
      transition: all 0.5s ease;
    }
    .night-mode .compliment-box {
      background: linear-gradient(135deg, #1a1a3a, #2a2a4a);
      color: #e6e6ff;
    }

    .generate-compliment {
      background: linear-gradient(90deg,#ff7aa3,#ff5480);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 5px;
      transition: all 0.5s ease;
    }
    .night-mode .generate-compliment {
      background: linear-gradient(90deg,#ffd700,#ffed4e);
      color: #0a0a2a;
    }

    /* –í–∞–∂–Ω—ã–µ –¥–∞—Ç—ã */
    .dates-section {
      position: relative;
    }
    
    .dates-section h3 {
      margin: 0 0 15px 0;
      text-align: center;
      color: var(--accent);
    }
    
    .calendar-dates-container {
      margin-top: 0;
    }
    
    .calendar-date {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,200,220,0.5);
      margin: 0;
      transition: all 0.5s ease;
    }
    .night-mode .calendar-date {
      border-bottom: 1px solid rgba(255,215,0,0.3);
    }
    
    .calendar-date:last-child {
      border-bottom: none;
    }
    
    .date-event {
      font-weight: 600;
      color: var(--accent);
      flex: 1;
      margin-right: 15px;
      line-height: 1.4;
    }
    
    .date-days {
      color: #888;
      font-size: 0.9rem;
      white-space: nowrap;
      text-align: right;
      min-width: 120px;
      transition: all 0.5s ease;
    }
    .night-mode .date-days {
      color: #a8a8ff;
    }

    /* –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è */
    .achievements-system {
      margin: 0;
    }
    
    .achievements-system h3 {
      margin: 0 0 15px 0;
      text-align: center;
      color: var(--accent);
    }
    
    .achievement {
      display: flex;
      align-items: center;
      padding: 10px;
      margin: 8px 0;
      background: rgba(255,255,255,0.8);
      border-radius: 10px;
      border-left: 4px solid var(--accent);
      transition: all 0.5s ease;
    }
    .night-mode .achievement {
      background: rgba(30,30,58,0.8);
    }
    
    .achievement.unlocked {
      background: linear-gradient(135deg, #a8e6cf, #88d498);
      color: white;
    }
    
    .achievement-icon {
      font-size: 1.5rem;
      margin-right: 10px;
    }
    
    .achievement-text {
      flex: 1;
    }

    /* –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ */
    .planning-calendar {
      margin: 0;
    }
    
    .planning-calendar h3 {
      margin: 0 0 15px 0;
      text-align: center;
      color: var(--accent);
    }
    
    .planning-form {
      display: grid;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .planning-form input {
      padding: 10px;
      border: 2px solid rgba(255,200,220,0.5);
      border-radius: 8px;
      font-size: 1rem;
      background: white;
      transition: all 0.5s ease;
    }
    .night-mode .planning-form input {
      background: #2a2a4a;
      border: 2px solid rgba(255,215,0,0.3);
      color: #e6e6ff;
    }
    
    .planning-form button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .night-mode .planning-form button {
      color: #0a0a2a;
    }
    
    .plans-list {
      max-height: 200px;
      overflow-y: auto;
    }
    
    .plan-item {
      padding: 8px;
      margin: 5px 0;
      background: rgba(255,245,247,0.7);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.5s ease;
    }
    .night-mode .plan-item {
      background: rgba(42,42,74,0.7);
    }

    .plan-actions {
      display: flex;
      gap: 8px;
    }

    .edit-btn {
      background: linear-gradient(135deg, #a8e6cf, #88d498);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.9rem;
      min-width: 40px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .delete-btn {
      background: linear-gradient(90deg,#ff7aa3,#ff5480);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.9rem;
      min-width: 40px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .night-mode .delete-btn {
      background: linear-gradient(90deg,#ffd700,#ffed4e);
      color: #0a0a2a;
    }

    /* –°—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π */
    .days-counter-section {
      text-align: center;
      padding: 20px 15px;
    }
    
    .days-counter {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ff6b95, #ff8eb4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 5px 0;
      animation: pulse 2s ease-in-out infinite;
    }
    .night-mode .days-counter {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .days-text {
      font-size: 1.1rem;
      color: var(--text);
      font-weight: 600;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ */
    .theme-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 12px;
      border-radius: 50%;
      box-shadow: 0 4px 15px rgba(255,92,138,0.3);
      z-index: 1000;
      font-weight: 600;
      color: var(--accent);
      backdrop-filter: blur(10px);
      border: 2px solid var(--accent);
      cursor: pointer;
      transition: all 0.5s ease;
    }
    .night-mode .theme-toggle {
      background: rgba(30,30,58,0.9);
      box-shadow: 0 4px 15px rgba(255,215,0,0.3);
    }

    /* –°—á–µ—Ç—á–∏–∫–∏ */
    .heart-counter {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.9);
      padding: 10px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 15px rgba(255,92,138,0.3);
      z-index: 1000;
      font-weight: 600;
      color: var(--accent);
      backdrop-filter: blur(10px);
      border: 2px solid var(--accent);
      transition: all 0.5s ease;
    }
    .night-mode .heart-counter {
      display: none;
    }

    .star-counter {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(30,30,58,0.9);
      padding: 10px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 15px rgba(255,215,0,0.3);
      z-index: 1000;
      font-weight: 600;
      color: #ffd700;
      backdrop-filter: blur(10px);
      border: 2px solid #ffd700;
      transition: all 0.5s ease;
      display: none;
    }
    .night-mode .star-counter {
      display: block;
    }

    #heartCount, #starCount {
      display: inline-block;
      transition: transform 0.3s ease;
      font-weight: 700;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
    .sync-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255,255,255,0.9);
      padding: 8px 15px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(255,92,138,0.3);
      z-index: 1000;
      font-weight: 600;
      color: var(--accent);
      backdrop-filter: blur(10px);
      border: 2px solid var(--accent);
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.5s ease;
    }
    .night-mode .sync-indicator {
      background: rgba(30,30,58,0.9);
      box-shadow: 0 4px 15px rgba(255,215,0,0.3);
    }
    
    .sync-indicator.syncing {
      animation: pulse 1.5s infinite;
    }
    
    .sync-indicator.error {
      background: rgba(255,100,100,0.9);
      color: white;
    }

    /* Custom scrollbars */
    .plans-list::-webkit-scrollbar {
      width: 8px;
    }
    .plans-list::-webkit-scrollbar-track {
      background: rgba(255, 220, 230, 0.3);
      border-radius: 4px;
    }
    .plans-list::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 4px;
    }
    .night-mode .plans-list::-webkit-scrollbar-track {
      background: rgba(255,215,0,0.2);
    }

    @media (max-width:520px){
      body{padding:16px}
      .header{gap:10px}
      .logo{width:60px;height:60px}
      .card{padding:18px}
      .planning-form {
        grid-template-columns: 1fr;
      }
      .calendar-date {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
      .date-event {
        margin-right: 0;
      }
      .date-days {
        text-align: left;
        min-width: auto;
      }
      .days-counter {
        font-size: 2.2rem;
      }
      .theme-toggle {
        top: 10px;
        left: 10px;
        padding: 10px;
      }
      .heart-counter, .star-counter {
        top: 10px;
        right: 10px;
        padding: 8px 16px;
      }
      .sync-indicator {
        bottom: 10px;
        right: 10px;
        padding: 6px 12px;
        font-size: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <div class="hearts" aria-hidden="true"></div>
  <div class="stars" aria-hidden="true"></div>
  <div class="theme-toggle" id="themeToggle">üåô</div>
  <div class="heart-counter">
    üíñ <span id="heartCount">0</span>
  </div>
  <div class="star-counter">
    ‚≠ê <span id="starCount">0</span>
  </div>
  <div class="sync-indicator" id="syncIndicator">
    <span id="syncStatus">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...</span>
  </div>
  
  <div class="card" role="main">
    <div class="header">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21s-6.5-4.35-9-7.1C-0.5 9.5 3 4 7.5 5.5 10 6.5 12 9 12 9s2-2.5 4.5-3.5C21 4 24.5 9.5 21 13.9 18.5 16.65 12 21 12 21z" fill="#fff" opacity="0.12"/><path d="M12 21s-6.5-4.35-9-7.1C-0.5 9.5 3 4 7.5 5.5 10 6.5 12 9 12 9s2-2.5 4.5-3.5C21 4 24.5 9.5 21 13.9 18.5 16.65 12 21 12 21z" stroke="#fff" stroke-width="0.6" fill="transparent"/></svg>
      </div>
      <div>
        <h1>–ú–æ—ë —Å–æ–ª–Ω—Ü–µ!</h1>
        <p class="lead">–≠—Ç–æ —Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –Ω–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –ª—é–±–≤–∏</p>
      </div>
    </div>

    <!-- –°—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π –≤–º–µ—Å—Ç–µ -->
    <div class="section days-counter-section">
      <h3>üìÖ –ú—ã –≤–º–µ—Å—Ç–µ —É–∂–µ</h3>
      <div class="days-counter" id="daysCounter">0</div>
      <div class="days-text" id="daysText">–¥–Ω–µ–π —Å—á–∞—Å—Ç—å—è!</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 1: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤ -->
    <div class="section">
      <div class="compliment-generator">
        <h3>üíù –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤</h3>
        <button class="generate-compliment" id="generateCompliment">
          –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç ‚ú®
        </button>
        <div class="compliment-box" id="complimentText">
          –ó–¥–µ—Å—å —Ç–∞–∏—Ç—Å—è –º–æ—è –ª—é–±–æ–≤—å üíù
        </div>
      </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 2: –í–∞–∂–Ω—ã–µ –¥–∞—Ç—ã -->
    <div class="section dates-section">
      <h3>üìÖ –ù–∞—à–∏ –≤–∞–∂–Ω—ã–µ –¥–∞—Ç—ã</h3>
      <div class="calendar-dates-container" id="calendarDates">
        <!-- –î–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
      </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 3: –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
    <div class="section">
      <div class="achievements-system">
        <h3>üèÜ –ù–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
        <div id="achievementsList">
          <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 4: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ -->
    <div class="section">
      <div class="planning-calendar">
        <h3>üìù –ü–ª–∞–Ω–∏—Ä—É–µ–º –≤–º–µ—Å—Ç–µ</h3>
        <div class="planning-form">
          <input type="text" id="planTitle" placeholder="–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º?">
          <input type="date" id="planDate">
          <input type="time" id="planTime">
          <button id="addPlan">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
        </div>
        <div class="plans-list" id="plansList">
          <!-- –ü–ª–∞–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
      </div>
    </div>

    <footer>–° –ª—é–±–æ–≤—å—é –¥–ª—è —Ç–µ–±—è ‚ù§Ô∏è</footer>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase - –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    let db = null;
    let isFirebaseInitialized = false;
    
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      isFirebaseInitialized = true;
      console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
      updateSyncStatus("‚ùå –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º", true);
    }

    let heartExplosionCount = 0;
    let starExplosionCount = 0;
    const heartCountElement = document.getElementById('heartCount');
    const starCountElement = document.getElementById('starCount');
    let isNightMode = false;

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–ª–∞—á–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
    async function savePlansToCloud(plans) {
      if (!isFirebaseInitialized) {
        // –ï—Å–ª–∏ Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ localStorage
        localStorage.setItem('ourPlans', JSON.stringify(plans));
        return;
      }
      
      try {
        updateSyncStatus("üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...", false, true);
        
        await db.collection('lovealina').doc('plans').set({
          plans: plans,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        updateSyncStatus("‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ", false);
        
        // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø–∞
        localStorage.setItem('ourPlans', JSON.stringify(plans));
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –æ–±–ª–∞–∫–æ:", error);
        updateSyncStatus("‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏", true);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        localStorage.setItem('ourPlans', JSON.stringify(plans));
      }
    }

    async function loadPlansFromCloud() {
      if (!isFirebaseInitialized) {
        // –ï—Å–ª–∏ Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
        const localPlans = localStorage.getItem('ourPlans');
        return localPlans ? JSON.parse(localPlans) : [];
      }
      
      try {
        updateSyncStatus("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...", false, true);
        
        const doc = await db.collection('lovealina').doc('plans').get();
        
        if (doc.exists) {
          const data = doc.data();
          updateSyncStatus("‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ", false);
          return data.plans || [];
        } else {
          updateSyncStatus("‚úÖ –ì–æ—Ç–æ–≤–æ", false);
          return [];
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –æ–±–ª–∞–∫–∞:", error);
        updateSyncStatus("‚ùå –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º", true);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        const localPlans = localStorage.getItem('ourPlans');
        return localPlans ? JSON.parse(localPlans) : [];
      }
    }

    function updateSyncStatus(message, isError = false, isSyncing = false) {
      const syncIndicator = document.getElementById('syncIndicator');
      const syncStatus = document.getElementById('syncStatus');
      
      syncStatus.textContent = message;
      
      if (isError) {
        syncIndicator.classList.add('error');
        syncIndicator.classList.remove('syncing');
      } else if (isSyncing) {
        syncIndicator.classList.add('syncing');
        syncIndicator.classList.remove('error');
      } else {
        syncIndicator.classList.remove('error', 'syncing');
      }
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã, –µ—Å–ª–∏ –Ω–µ –æ—à–∏–±–∫–∞
      if (!isError) {
        setTimeout(() => {
          syncIndicator.style.opacity = '0.7';
        }, 3000);
      } else {
        syncIndicator.style.opacity = '1';
      }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ localStorage
    function saveCounters() {
      const counters = {
        heartExplosionCount,
        starExplosionCount
      };
      localStorage.setItem('loveCounters', JSON.stringify(counters));
    }

    function loadCounters() {
      const savedCounters = localStorage.getItem('loveCounters');
      if (savedCounters) {
        const counters = JSON.parse(savedCounters);
        heartExplosionCount = counters.heartExplosionCount || 0;
        starExplosionCount = counters.starExplosionCount || 0;
        
        heartCountElement.textContent = heartExplosionCount;
        starCountElement.textContent = starExplosionCount;
      }
    }

    // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –Ω–æ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    // ... (—Ñ—É–Ω–∫—Ü–∏–∏ createHeartParticles, createStarParticles, makeHeart, makeStar –∏ —Ç.–¥.)

    // –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ–±–ª–∞—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
    let plans = [];
    let editingIndex = null;

    async function renderPlans() {
      const plansContainer = document.getElementById('plansList');
      plansContainer.innerHTML = '';
      
      plans.forEach((plan, index) => {
        const planElement = document.createElement('div');
        planElement.className = 'plan-item';
        const displayTime = plan.time ? ` –≤ ${plan.time}` : '';
        const formattedDate = formatDate(plan.date);
        planElement.innerHTML = `
          <div>
            <strong>${plan.title}</strong> - ${formattedDate}${displayTime}
          </div>
          <div class="plan-actions">
            <button class="edit-btn" onclick="editPlan(${index})">‚úèÔ∏è</button>
            <button class="delete-btn" onclick="removePlan(${index})">√ó</button>
          </div>
        `;
        plansContainer.appendChild(planElement);
      });
    }

    async function addPlan() {
      const title = document.getElementById('planTitle').value;
      const date = document.getElementById('planDate').value;
      const time = document.getElementById('planTime').value;
      
      if (title && date) {
        if (editingIndex !== null) {
          // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ
          plans[editingIndex] = { title, date, time };
          editingIndex = null;
          document.getElementById('addPlan').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ';
        } else {
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
          plans.push({ title, date, time });
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ –∏ localStorage
        await savePlansToCloud(plans);
        await renderPlans();
        
        document.getElementById('planTitle').value = '';
        document.getElementById('planDate').value = '';
        document.getElementById('planTime').value = '';
      }
    }

    async function removePlan(index) {
      plans.splice(index, 1);
      await savePlansToCloud(plans);
      await renderPlans();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', async function() {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –∏–∑ localStorage
      loadCounters();
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–∞–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞
      plans = await loadPlansFromCloud();
      
      updateDaysCounter();
      renderCalendar();
      renderAchievements();
      renderPlans();
      
      // –û—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
      startHearts();
      startStars();
      
      for(let i=0;i<10;i++) makeHeart();
      
      setInterval(updateDaysCounter, 24 * 60 * 60 * 1000);
    });

    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('addPlan').addEventListener('click', addPlan);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–∏/–∑–≤–µ–∑–¥—ã
    const originalMakeHeart = makeHeart;
    makeHeart = function(i) {
      const el = originalMakeHeart(i);
      el.addEventListener('click', function() {
        // –ü–æ—Å–ª–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        setTimeout(saveCounters, 100);
      });
      return el;
    };

    const originalMakeStar = makeStar;
    makeStar = function(i) {
      const el = originalMakeStar(i);
      el.addEventListener('click', function() {
        // –ü–æ—Å–ª–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        setTimeout(saveCounters, 100);
      });
      return el;
    };

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (updateDaysCounter, renderCalendar, renderAchievements –∏ —Ç.–¥.)
    // –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞...
  </script>
</body>
</html>
